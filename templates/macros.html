{% macro render_rank_table(prefix, market_name, volume_data, value_data, gainers_data, losers_data, today_date) %}
<div class="card">
    <div class="card-body">
        <h5 class="card-title mb-3" id="{{ prefix }}-rank-title">
            {{ today_date }} {{ market_name }} 거래량 상위
        </h5>
        <div class="btn-group btn-group-sm mb-3" id="{{ prefix }}-rank-selector">
            <button type="button" class="btn btn-outline-secondary active" data-target="volume">거래량</button>
            <button type="button" class="btn btn-outline-secondary" data-target="value">거래대금</button>
            <button type="button" class="btn btn-outline-secondary" data-target="gainer">상승률</button>
            <button type="button" class="btn btn-outline-secondary" data-target="loser">하락률</button>
        </div>

        <div class="table-responsive" id="{{ prefix }}-volume-table">
            <table class="table rank-table">
                <thead>
                    <tr>
                        <th class="stock-name-header">종목명</th>
                        <th class="text-end">현재가</th>
                        <th class="text-end">등락률</th>
                        <th class="text-end">거래량</th>
                        <th class="text-end">거래대금</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in volume_data %}
                    <tr>
                        <td class="stock-name" data-code="{{ item.Code }}">{{ item.Name }}</td>
                        <td class="text-end">{{ item.Close | format_price }}</td>
                        <td class="text-end {% if item.ChangeRatio > 0 %}text-danger{% elif item.ChangeRatio < 0 %}text-primary{% endif %}">{{ item.ChangeRatio | round(2) }}%</td>
                        <td class="text-end">{{ item.Volume | format_kr }}</td>
                        <td class="text-end">{{ item.TradingValue | format_value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="table-responsive" id="{{ prefix }}-value-table" style="display: none;">
            <table class="table rank-table">
                <thead>
                    <tr>
                        <th class="stock-name-header">종목명</th>
                        <th class="text-end">현재가</th>
                        <th class="text-end">등락률</th>
                        <th class="text-end">거래량</th>
                        <th class="text-end">거래대금</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in value_data %}
                    <tr>
                        <td class="stock-name" data-code="{{ item.Code }}">{{ item.Name }}</td>
                        <td class="text-end">{{ item.Close | format_price }}</td>
                        <td class="text-end {% if item.ChangeRatio > 0 %}text-danger{% elif item.ChangeRatio < 0 %}text-primary{% endif %}">{{ item.ChangeRatio | round(2) }}%</td>
                        <td class="text-end">{{ item.Volume | format_kr }}</td>
                        <td class="text-end">{{ item.TradingValue | format_value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="table-responsive" id="{{ prefix }}-gainer-table" style="display: none;">
            <table class="table rank-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th class="stock-name-header">종목명</th>
                        <th class="text-end">현재가</th>
                        <th class="text-end">등락률</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in gainers_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="stock-name" data-code="{{ item.Code }}">{{ item.Name }}</td>
                        <td class="text-end">{{ item.Close | format_price }}</td>
                        <td class="text-end {% if item.ChangeRatio > 0 %}text-danger{% else %}text-primary{% endif %}">{{ item.ChangeRatio | round(2) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="table-responsive" id="{{ prefix }}-loser-table" style="display: none;">
            <table class="table rank-table">
                <thead>
                    <tr>
                        <th>순위</th>
                        <th class="stock-name-header">종목명</th>
                        <th class="text-end">현재가</th>
                        <th class="text-end">등락률</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in losers_data %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="stock-name" data-code="{{ item.Code }}">{{ item.Name }}</td>
                        <td class="text-end">{{ item.Close | format_price }}</td>
                        <td class="text-end {% if item.ChangeRatio < 0 %}text-primary{% else %}text-danger{% endif %}">{{ item.ChangeRatio | round(2) }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endmacro %}