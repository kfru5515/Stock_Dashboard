<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-t">
    <title>AskFin - AI 질문 분석</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="{{ url_for('static', filename='template/css/templatemo_main.css') }}">
    <style>
        /* CSS 스타일은 기존과 동일하게 유지 */
        #results-container { margin-top: 20px; padding: 20px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; display: none; }
        .spinner { display: none; margin: 20px auto; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="navbar navbar-inverse" role="navigation">
    <div class="navbar-header">
        <div class="logo"><h1>Final Project</h1></div>
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
        </button>
    </div>
</div>

<div class="template-page-wrapper">
    <div class="navbar-collapse collapse templatemo-sidebar">
        <ul class="templatemo-sidebar-menu">
            <li><a href="{{ url_for('index') }}"><i class="fa fa-home"></i>HOME</a></li>
            <li class="active"><a href="{{ url_for('askfin_page') }}"><i class="fa fa-question-circle"></i>AskFin</a></li>
            </ul>
    </div>

    <div class="templatemo-content-wrapper">
        <div class="templatemo-content">
            
            <h1>AskFin - AI 질문 분석</h1>
            <p>분석하고 싶은 질문을 자연어로 입력하세요. (예: 지난 3년간 여름에 가장 많이 오른 제약주는?)</p>
            
            <hr>

            <div class="row">
                <div class="col-md-12">
                    <form id="askfin-form" class="form-inline">
                        <div class="form-group" style="width: 80%;">
                            <input type="text" class="form-control" id="query-input" placeholder="질문을 입력하세요..." style="width: 100%;">
                        </div>
                        <button type="submit" class="btn btn-primary">분석하기</button>
                    </form>
                </div>
            </div>

            <div id="loading-spinner" class="spinner"></div>

            <div id="results-container">
                <h3>분석 결과</h3>
                <pre id="results-json"></pre>
            </div>

        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='template/js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='template/js/bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='template/js/templatemo_script.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // JavaScript 로직은 form id만 'askfin-form'으로 변경하고 나머지는 동일합니다.
    const form = document.getElementById('askfin-form');
    const input = document.getElementById('query-input');
    const resultsContainer = document.getElementById('results-container');
    const resultsJson = document.getElementById('results-json');
    const spinner = document.getElementById('loading-spinner');

    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const query = input.value.trim();
        if (!query) { alert('질문을 입력해주세요.'); return; }

        resultsContainer.style.display = 'none';
        spinner.style.display = 'block';

        fetch('/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: query })
        })
        .then(response => {
            if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
            return response.json();
        })
        .then(data => {
            spinner.style.display = 'none';
            if (data.error) {
                resultsJson.textContent = `오류가 발생했습니다: \n${data.error}`;
            } else {
                resultsJson.textContent = JSON.stringify(data, null, 2);
            }
            resultsContainer.style.display = 'block';
        })
        .catch(error => {
            spinner.style.display = 'none';
            resultsContainer.style.display = 'block';
            resultsJson.textContent = `분석 중 심각한 오류가 발생했습니다: \n${error}`;
        });
    });
});
</script>

</body>
</html>