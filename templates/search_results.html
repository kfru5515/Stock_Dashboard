{% extends "base.html" %}

{% block content %}
<h3>검색 결과: "{{ query }}"</h3>
{% if results %}
<ul>
  {% for stock in results %}
  <li>
    <a href="{{ url_for('search.stock_detail', code=stock.code) }}">
      {{ stock.name }} ({{ stock.code }}) - 현재가: {{ stock.currentPrice }}원
    </a>
    <br>
    📈 <strong>예측된 단기 추세:</strong>
    <span style="color:green;">{{ stock.prediction }}</span>

    <!-- 실제 차트 -->
    <canvas id="chart-{{ loop.index }}" width="400" height="150"></canvas>    
  </li>
  {% endfor %}
</ul>

<!-- Chart.js CDN 추가 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  {% for stock in results %}
  const ctx{{ loop.index }} = document.getElementById('chart-{{ loop.index }}').getContext('2d');
  new Chart(ctx{{ loop.index }}, {
    type: 'line',
    data: {
      labels: ['최근 5일 전', '4일 전', '3일 전', '2일 전', '최신'],
      datasets: [{
        label: '{{ stock.name }} 주가',
        data: {{ stock.price_chart | tojson }},
        backgroundColor: 'rgba(75, 192, 192, 0.3)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
  {% endfor %}
</script>
{% else %}
<p>검색 결과가 없습니다.</p>
{% endif %}
{% endblock %}