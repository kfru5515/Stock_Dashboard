{% extends "base.html" %}

{% block content %}
<h3>ê²€ìƒ‰ ê²°ê³¼: "{{ query }}"</h3>
{% if results %}
<ul>
  {% for stock in results %}
  <li>
    <a href="{{ url_for('search.stock_detail', code=stock.code) }}">
      {{ stock.name }} ({{ stock.code }}) - í˜„ì¬ê°€: {{ stock.currentPrice }}ì›
    </a>
    <br>
    ğŸ“ˆ <strong>ì˜ˆì¸¡ëœ ë‹¨ê¸° ì¶”ì„¸:</strong>
    <span style="color:green;">{{ stock.prediction }}</span>

    <!-- ì‹¤ì œ ì°¨íŠ¸ -->
    <canvas id="chart-{{ loop.index }}" width="400" height="150"></canvas>    
  </li>
  {% endfor %}
</ul>

<!-- Chart.js CDN ì¶”ê°€ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  {% for stock in results %}
  const ctx{{ loop.index }} = document.getElementById('chart-{{ loop.index }}').getContext('2d');
  new Chart(ctx{{ loop.index }}, {
    type: 'line',
    data: {
      labels: ['ìµœê·¼ 5ì¼ ì „', '4ì¼ ì „', '3ì¼ ì „', '2ì¼ ì „', 'ìµœì‹ '],
      datasets: [{
        label: '{{ stock.name }} ì£¼ê°€',
        data: {{ stock.price_chart | tojson }},
        backgroundColor: 'rgba(75, 192, 192, 0.3)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
  {% endfor %}
</script>
{% else %}
<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}
{% endblock %}